<!DOCTYPE html>
<html lang="en">
    <head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <meta name="description" content="">
        <meta name="author" content="">

        <title>CFO - Admin</title>

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.css">
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
        <style>
            body{padding-top:40px;padding-bottom:40px;background-color:#eee}.form-signin{max-width:330px;padding:15px;margin:0 auto}.form-signin .form-signin-heading,.form-signin .checkbox{margin-bottom:10px}.form-signin .checkbox{font-weight:normal}.form-signin .form-control{position:relative;height:auto;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:10px;font-size:16px}.form-signin .form-control:focus{z-index:2}.form-signin input[type="email"]{margin-bottom:-1px;border-bottom-right-radius:0;border-bottom-left-radius:0}.form-signin input[type="password"]{margin-bottom:10px;border-top-left-radius:0;border-top-right-radius:0}
        </style>
        <link rel="stylesheet" href="css/reset.css">
<link rel="stylesheet" href="css/style.css">
          <link rel="stylesheet" href="css/login_style.css">

    </head>
    <body style="background: #FCF8E3;">
    <header>
    <div class="row" align="center">
    <a href="index.html"><img src="img/logo.png" alt=""  /></a>

    </div>
   <div class="row" align="center">
    <a href="index.html"><img src="img/cfo.png" alt=""  /></a>

<ul >
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" style="margin-left: 129px;" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> <i class="fa fa-cog"> settings</i> <span class="caret"></span></a>
                      <ul class="dropdown-menu" style="margin-left: 33%">
                        <li class="manage-users"><a href="user.html"><i class="fa fa-users"> Manage Users</i></a></li>
                        <li><a href="profile.html"><i class="fa fa-sign-out"></i> Profile</a></li>
                        <li><a href="index.html"><i class="fa fa-sign-out">  Logout</i></a></li>
                      </ul>
                    </li>
                  </ul>

</header>

        <div class="container" style="padding: 5% 0">
            <div class="row">
                <div class="col-lg-12">
                    <div class="pull-right">
                        <div class="btn-toolbar list-toolbar">
                            <button class="btn btn-primary user-add-button" data-toggle="modal" data-target="#myModal"><i class="fa fa-plus"></i>&nbsp; Add User</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" style="padding-top: 20px; color: black;">
                <div class="col-lg-12">
                    <table class="table .table-hover">
                      <thead>
                        <tr>
                          <th><strong>ID</strong></th>
                          <th><strong>User Chat Name</strong></th>
                          <th><strong>Database Name</strong></th>
                          <th style="width: 3.5em;"></th>
                        </tr>
                      </thead>
                      <tbody class="users-list">

                      </tbody>
                    </table>
                </div>
            </div>
        </div>
         <script id="user-list-template" type="text/x-handlebars-template">
           <tr>
             <td>{{id}}</td>
             <td>{{name}}</td>
             <td>{{user_name}}</td>
             <td>
                 <a class="user-delete-button" data-id="{{id}}" href="#" role="button" data-toggle="modal"><i class="fa fa-trash-o"></i></a>
             </td>
           </tr>
         </script>
       <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
       <script src='https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.0/handlebars.min.js'></script>
       <script src='https://cdnjs.cloudflare.com/ajax/libs/list.js/1.1.1/list.min.js'></script>
        <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="color: black;">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form class="user-add-form">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Add User</h4>
                  </div>
                  <div class="modal-body">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <label class="control-label col-sm-2" for="email">Email:</label>
                            <div class="col-sm-10">
                              <input type="email" class="form-control" id="email" placeholder="Enter email" required="true">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2" for="pwd">Password:</label>
                            <div class="col-sm-10">
                              <input type="password" class="form-control" id="pwd" placeholder="Enter password" required="true">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2" for="pwd">Admin</label>
                            <div class="col-sm-10">
                              <input type="checkbox" id="admin">
                            </div>
                        </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default modal-close-button" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                  </div>
                </form>
            </div>
          </div>
        </div>
    </body>
</html>
<script>
    var url = "https://powerful-lowlands-6504.herokuapp.com/public";
    jQuery(document).ready(function(){
        var token = localStorage.getItem("token");
        var source = $("#user-list-template").html();
        var template = Handlebars.compile(source);
        var userData = false;
        $.ajax({
          method: "GET",
          url: url+"/user/info",
          data: { token: token},
          error: function() { window.location.href = 'index.html'; }
        }).done(function(result) {
            if(result) {
                userData = result;
                init();
            }
        });
        var init = function() {
            jQuery('.user-name').text(userData.name);
            if(userData.admin != 1) {
                jQuery('.manage-users').addClass('hide');
            }
            var userElement = jQuery('.users-list');
            $.ajax({
              method: "GET",
              url: url+"/users",
              data: { token: token}
            }).done(function(result) {
                if(result) {
                    jQuery.each(result, function(key, data) {
                        var context = {name: data.name, id: data.id, user_name: data.user_name};
                        var html = template(context);
                        userElement.append(html);
                    });
                }
            });
            var form = jQuery('.user-add-form');
            form.submit(function(e) {
                e.preventDefault();
                var email = form.find('#email').val();
                var password = form.find('#pwd').val();
                var admin = 0;
                if(form.find('#admin').prop('checked')) {
                    var admin = 1;
                }
                $.ajax({
                  method: "POST",
                  url: url+"/user/add?token="+token,
                  data: { email: email, password: password, admin: admin}
                }).done(function(data) {
                    form.find('.modal-close-button').trigger('click');
                    if(data) {
                        var context = {name: data.name, id: data.id, user_name: data.user_name};
                        var html = template(context);
                        userElement.append(html);
                    }
                });
            });
        }
    });
</script>
